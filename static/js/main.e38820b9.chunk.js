(this["webpackJsonpuser-behavior-visualization-demo"]=this["webpackJsonpuser-behavior-visualization-demo"]||[]).push([[0],{144:function(t,e,n){},145:function(t,e,n){},153:function(t,e,n){},154:function(t,e,n){},167:function(t,e,n){},169:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n.n(r),i=n(24),c=n.n(i),o=(n(144),n.p,n(145),n(1));var l=n(5),s=n(9),u=n(10),d=n(8),f=n(11),p=n(12),h=n(34),m=n.n(h),g=(n(168),n(71)),v=function(t){Object(f.a)(n,t);var e=Object(p.a)(n);function n(t){var r;return Object(s.a)(this,n),(r=e.call(this,t)).getCR=function(t,e){var n=r.props.onSubmit;r.setState((function(){return{type:e}})),n(t)},r.state=t.init,r}return Object(u.a)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.show,r=e.init,a=r.pagename,i=r.since,c=r.until,l=r.wordfilter,s=r.authorfilter,u=r.idfilter,d=r.contentfilter,f=r.commentfilter,p=(e.onChange,e.handlePT);return n?Object(o.jsx)("div",{id:"Page1",className:"tabcontent",children:Object(o.jsxs)("fieldset",{children:[Object(o.jsxs)("label",{htmlFor:"x",children:["Board:",Object(o.jsx)("input",{className:"form-control",name:"pagename",id:"pagename1",type:"text",list:"pagenamelist",value:a,onChange:p})]}),Object(o.jsxs)("label",{htmlFor:"x",children:["Time:",Object(o.jsx)("input",{className:"form-control date",type:"date",name:"since",id:"date1",placeholder:"date",value:i,onChange:p})]}),Object(o.jsx)("span",{children:"~ \xa0 "}),Object(o.jsx)("label",{htmlFor:"x",children:Object(o.jsx)("input",{className:"form-control date",type:"date",name:"until",id:"date2",placeholder:"date",value:c,onChange:p})}),Object(o.jsxs)("label",{htmlFor:"x",children:["Title:",Object(o.jsx)("input",{className:"form-control",type:"keyword1",name:"wordfilter",id:"keyword1",placeholder:"keyword ex: \u7e3d\u7d71|\u5927\u9078",value:l,onChange:p})]}),Object(o.jsxs)("label",{htmlFor:"x",children:["AuthorID:",Object(o.jsx)("input",{className:"form-control",type:"authorid1",name:"authorfilter",id:"authorid1",placeholder:"authorid",value:s,onChange:p})]}),Object(o.jsxs)("label",{htmlFor:"x",children:["UserID:",Object(o.jsx)("input",{className:"form-control",type:"userid1",name:"idfilter",id:"userid1",placeholder:"userid",value:u,onChange:p})]}),Object(o.jsxs)("label",{htmlFor:"x",children:["Content word:",Object(o.jsx)("input",{className:"form-control",type:"keyword3",name:"contentfilter",id:"keyword3",placeholder:"keyword",value:d,onChange:p})]}),Object(o.jsxs)("label",{htmlFor:"x",children:["#comments >",Object(o.jsx)("input",{className:"form-control",type:"commentThreshold",name:"commentfilter",id:"commentThreshold",placeholder:"500",value:f,onChange:p})]}),Object(o.jsx)(g.a,{name:"submit",type:"button",size:"sm",onClick:function(e){return t.getCR(e,"All")},children:"Query Submit"})]})}):null}}]),n}(a.a.Component);v.defaultProps={};var y=v,x=function(t){Object(f.a)(n,t);var e=Object(p.a)(n);function n(t){var r;return Object(s.a)(this,n),(r=e.call(this,t)).openTab=function(t,e){switch(e){case"Page1":r.setState((function(){return{showPage1:!0}}))}},r.handleCloseTab=function(){r.setState((function(){return{showPage1:!0}}))},r.state=Object(l.a)(Object(l.a)({},t.menuprops),{},{showPage1:!0}),r.openTab=r.openTab.bind(Object(d.a)(r)),r.handleCloseTab=r.handleCloseTab.bind(Object(d.a)(r)),r}return Object(u.a)(n,[{key:"render",value:function(){var t=this.state.showPage1,e=this.props,n=e.onSubmit,r=e.menuprops.initPage1,a=e.handlePT1;return Object(o.jsx)("div",{className:"box menu",children:Object(o.jsx)(y,{show:t,init:r,onChange:this.handleCloseTab,handlePT:a,onSubmit:n})})}}]),n}(a.a.Component);x.defaultProps={};var b=x,w=(n(153),function(t){var e=t.isLoading,n=t.responseError,r=t.errorType;return n?Object(o.jsxs)("div",{className:"wrapperresponding",children:[Object(o.jsx)("div",{className:"responseerror",children:Object(o.jsx)("span",{id:"x",children:"X"})}),Object(o.jsx)("p",{className:"text",children:r.message})]}):e?Object(o.jsxs)("div",{className:"wrapperloading",children:[Object(o.jsx)("div",{className:"loading up"}),Object(o.jsx)("div",{className:"loading down"})]}):null}),_=(n(154),n(0)),k=n(6),D=n(14);function j(t,e,n){console.log(t,e,n);parseFloat(_.G("#timeLine").style("height"));var r=parseFloat(_.G("#timeLine").style("width")),a=_.F;0===t&&(n.selectAll("*").remove(),n.append("rect").attr("x",r/2-100).attr("y",50).attr("height",10).attr("width",1).attr("fill",a[0]),n.append("text").text("".concat(1," %")).attr("x",r/2-100+1+10).attr("y",60)),t>0&&(n.selectAll("rect").attr("x",r/2-100).attr("y",50).attr("height",10).attr("width",(function(){return t/e*200})),n.selectAll("text").text("".concat(Math.round(t/e*100)," %")).attr("x",r/2-100+t/e*200+10).attr("y",60))}function A(t,e,n,r){e.selectAll("*").remove();var a=parseFloat(_.G(".authorList").style("height")),i=JSON.parse(JSON.stringify(t)),c=JSON.parse(JSON.stringify(t));i.forEach((function(t){if(t.id){var e=t.id.split(" ");t.oldId=t.id;var n=Object(D.a)(e,1);t.id=n[0]}}));var o=_.G('input[name="pageRank"]').property("checked");o&&function(t){var e=[],n=[],r=new Date;(function(t,e,n){function r(t){switch(t){case"\u63a8":return 1;case"\u5653":return-2;default:return.5}}t.children.forEach((function(t){var a=t.responder.map((function(t){return t.message_count[0].count}));Math.max.apply(Math,Object(k.a)(a))>=0&&t.responder.forEach((function(a){e.push({id:t.id,pageRank:.25,post:[{article:a.articleId}],reply:[],weight:0});var i=1;a.message_count[0].count>=0&&a.message.every((function(c){var o=e.find((function(t){return t.id===c.push_userid}));o?o.reply.push({author:t.id,article:a.articleId,tag:c.push_tag}):e.push({id:c.push_userid,pageRank:.25,reply:[{author:t.id,article:a.articleId,tag:c.push_tag}],weight:0});var l=n.find((function(e){return e.source===c.push_userid&&e.target===t.id}));return l?(l.value+=r(c.push_tag),l.num+=1):n.push({source:c.push_userid,target:t.id,value:r(c.push_tag),num:1}),(i+=1)>0}))}))}))})(t,e,n),function(t,e){e.forEach((function(e){t.find((function(t){return t.id===e.source})).weight+=Math.abs(e.value/e.num)}))}(e,n),function(t,e,n){for(var r=t.length,a=e.length,i=1e-6,c=o?100:1,l=0;l<c;l+=1){for(var s=[],u=0;u<r;u+=1){for(var d=0,f=function(n){var r=e[n];if(r.target===t[u].id){var a=t.find((function(t){return t.id===r.source})),i=0;0!==a.weight&&(i=a.pageRank*(r.value/r.num/a.weight)),d+=i}},p=0;p<a;p+=1)f(p);s.push((1-n)/r+n*d)}for(var h=0,m=0;m<r;m+=1)h+=Math.abs(t[m].pageRank-s[m]);for(var g=0;g<r;g+=1)t[g].pageRank=s[g];if(j(l,c,_.G("#graph")),console.log("leaderPageRank: ".concat(h,", total_num * tolerance: ").concat(r*i)),h<=r*i)break}}(e,n,.85);var a=function(t){var e=0;return t.forEach((function(t){t.pageRank<e&&(e=t.pageRank)})),e}(e);t.children.forEach((function(t){var n=e.find((function(e){return e.id===t.id}));t.pageRank=n?n.pageRank+Math.abs(a)+1:Math.abs(a)+1})),console.log(t.children),console.log(r-new Date)}(i);_.G("#graph");i.forEach((function(t){var e=0;t.responder.forEach((function(t){e+=t.message_count.push,e-=t.message_count.boo,e+=t.message_count.neutral/2})),t.influence=e,t.pageRank=t.pageRank||e})),i.sort((function(t,e){return _.h(t.pageRank,e.pageRank)}));var l=JSON.parse(JSON.stringify(c));l=[],r(i,"test");var s=(e=e.append("div").style("max-height","".concat(a,"px"))).append("table"),u=s.append("tr");u.append("th").attr("class","tableHeader id").attr("width","30%").text("AuthorID"),u.append("th").attr("class","tableHeader deltaLength").attr("width","20%").text("LPR"),u.append("th").attr("class","tableHeader articleCount").attr("width","25%").text("# Of Articles"),u.append("th").attr("class","tableHeader messageCount").attr("width","25%").text("Total Comments"),s.selectAll(".tableHeader").style("background",_.F[0]).style("color","white");var d=s.selectAll("tr.data").data(i).enter().append("tr").attr("class","datarow").on("click",(function(t){console.log("table clicked");var e=JSON.parse(JSON.stringify(t));if(e.id=e.oldId,l.some((function(t){return t.id===e.id}))){var n=l.findIndex((function(t){return t.id===e.id}));l.length>1&&(l.splice(n,1),console.log(l,e),r(l,l[0].id))}else l.push(e),console.log(l,e),r(l,e.id),1}));d.append("td").text((function(t){return t.id})),d.append("td").text((function(t){return"".concat((e=t.pageRank,Number.parseFloat(e).toFixed(2)));var e})),d.append("td").text((function(t){return t.responder.length})),d.append("td").text((function(t){return t.responder.reduce((function(t,e){return t+e.messages.length}),0)})),_.H(".datarow").filter(":nth-child(even)").style("background","whitesmoke")}var O=n(36);function G(t,e,n,r,a){var i=this;n.selectAll("*").remove();var c=602,o=new Date(r);o.setHours(0,0,0);var l=new Date(a);l.setHours(23,59,59);var s=[];_.G("div#slider-range").select("svg").remove();var u=O.a().min(o).max(l).width(2/3*512-5).tickFormat(_.J("%m/%d %H")).ticks(5).default([o,l]).fill("#2196f3").on("onchange",(function(e){!function(e,n){if(h.domain([new Date(e),new Date(n)]),w){var r=t.find((function(t){return t.article_id===w})),a=new Date(r.date).getFullYear();A.selectAll(".commentTime").attr("cy",(function(t){var e=H(t),n=new Date(new Date(e).setFullYear(a));return h(n)})).attr("opacity",(function(t){var e=H(t),n=new Date(new Date(e).setFullYear(a));return h(n)<c&&h(n)>0?1:0}))}A.selectAll(".offday").attr("y",(function(t){return h(new Date(t))>0?h(new Date(t)):0})).attr("height",(function(t){var e=new Date(t),n=new Date(t);e.setDate(e.getDate()+1);var r=h(n)>0?h(n):0,a=h(e)<c?h(e):c;return Math.max(0,a-r)})).attr("opacity",(function(t){return h(new Date(t))<c?1:0})),A.selectAll(".beforWork").attr("y",(function(t){return h(new Date(t))>0?h(new Date(t)):0})).attr("height",(function(t){var e=new Date(t),n=new Date(t);e.setHours(e.getHours()+9);var r=h(n)>0?h(n):0,a=h(e)<c?h(e):c;return Math.max(0,a-r)})).attr("opacity",(function(t){return h(new Date(t))<c?1:0})),A.selectAll(".afterWork").attr("y",(function(t){return h(new Date(t))>0?h(new Date(t)):0})).attr("height",(function(t){var e=new Date(t),n=new Date(t);e.setHours(e.getHours()+6);var r=h(n)>0?h(n):0,a=h(e)<c?h(e):c;return Math.max(0,a-r)})).attr("opacity",(function(t){return h(new Date(t))<c?1:0}));_.z().domain(g).range([0,m]);var i=S.filter((function(t){return new Date(e)<new Date(t.date)&&new Date(n)>new Date(t.date)}));A.selectAll("path.repostLink").attr("visibility","hidden");for(var u=0;u<i.length;u+=1)for(var d=u+1;d<i.length&&(i[u].article_title&&i[d].article_title);d+=1)i[u].article_title===i[d].article_title.substring(4)&&function(){var t=h(new Date(i[u].date)),e=h(new Date(i[d].date)),n=i[u].article_id.replace(/\./gi,""),r=i[d].article_id.replace(/\./gi,""),a=[];i[u].messages.forEach((function(t){g.includes(t.push_userid)&&(a.includes(t.push_userid)||a.push(t.push_userid))}));var c=[];i[d].messages.forEach((function(t){g.includes(t.push_userid)&&(c.includes(t.push_userid)||c.push(t.push_userid))}));var o=_.w().curve(_.f).x((function(t){return t.x})).y((function(t){return t.y}));A.select("path#".concat(n,"_").concat(r)).attr("visibility","visible").attr("d",o([{x:E(a.length),y:t},{x:Math.min(E(a.length)-20,E(c.length)-20)-20,y:(t+e)/2},{x:E(c.length),y:e}]))}();o<new Date(e)||l>new Date(n)?s.forEach((function(t){var r=t.article_id.replace(/\./gi,"");A.selectAll(".articleID_".concat(r)).each((function(r,a,i){if("p"===_.G(i[a]).attr("class")[0])new Date(t.date)>new Date(e)&&new Date(t.date)<new Date(n)?(_.G(i[a]).attr("visibility","visible").selectAll("rect").attr("y",(function(t){return h(new Date(t.date))})).attr("opacity",(function(t){return h(new Date(t.date))<c&&h(new Date(t.date))>0?1:0})),_.G(i[a]).selectAll("circle").attr("cy",(function(t){return h(new Date(t.date))+1})).attr("opacity",(function(t){return h(new Date(t.date))<c&&h(new Date(t.date))>0?1:0}))):_.G(i[a]).attr("visibility","hidden");else{var o=new Date(t.date).getFullYear(),l=new Date(e);l.setDate(l.getDate()-2),new Date(t.date)>l&&new Date(t.date)<new Date(n)?_.G(i[a]).attr("visibility","visible").selectAll("circle").attr("cy",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(o));return h(r)})).attr("opacity",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(o));return h(r)<c&&h(r)>0?1:0})):_.G(i[a]).attr("visibility","hidden")}}))})):(A.selectAll(".pointer").each((function(r,a,i){var o=_.G(i[a]).attr("class").slice(18),l=t.find((function(t){return t.article_id.replace(/\./gi,"")===o}));new Date(l.date)>new Date(e)&&new Date(l.date)<new Date(n)?(_.G(i[a]).attr("visibility","visible").selectAll("rect").attr("y",(function(t){return h(new Date(t.date))})).attr("opacity",(function(t){return h(new Date(t.date))<c&&h(new Date(t.date))>0?1:0})),_.G(i[a]).selectAll("circle").attr("cy",(function(t){return h(new Date(t.date))+1})).attr("opacity",(function(t){return h(new Date(t.date))<c&&h(new Date(t.date))>0?1:0}))):_.G(i[a]).attr("visibility","hidden")})),A.selectAll(".article").each((function(r,a,i){var o=_.G(i[a]).attr("class").slice(18),l=t.find((function(t){return t.article_id.replace(/\./gi,"")===o})),s=new Date(l.date).getFullYear(),u=new Date(e);u.setDate(u.getDate()-2),new Date(l.date)>u&&new Date(l.date)<new Date(n)?_.G(i[a]).attr("visibility","visible").selectAll("circle").attr("cy",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(s));return h(r)})).attr("opacity",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(s));return h(r)<c&&h(r)>0?1:0})):_.G(i[a]).attr("visibility","hidden")})));s=t.filter((function(t){var r=new Date(e);return r.setDate(r.getDate()-2),new Date(r)<new Date(t.date)&&new Date(n)>new Date(t.date)}));var f=864e5;(n-e)/f<=1?A.select(".yAxis").call(_.b(h).tickFormat(_.J("%H:%M")).tickSizeInner([40])):(n-e)/f<5?A.select(".yAxis").call(_.b(h).ticks(_.I.every(1)).tickFormat(_.J("%m/%d %H:%M")).tickSizeInner([40])):(n-e)/f<15?A.select(".yAxis").call(_.b(h).ticks(_.I.every(3)).tickFormat(_.J("%m/%d")).tickSizeInner([40])):(n-e)/f<30?A.select(".yAxis").call(_.b(h).ticks(_.I.every(5)).tickFormat(_.J("%m/%d")).tickSizeInner([40])):(n-e)/f<60?A.select(".yAxis").call(_.b(h).ticks(_.I.every(10)).tickFormat(_.J("%m/%d")).tickSizeInner([40])):A.select(".yAxis").call(_.b(h).ticks(_.I.every(1)).tickFormat(_.J("%m/%d")).tickSizeInner([40]))}(new Date(e[0]),new Date(e[1])),o=new Date(e[0]),l=new Date(e[1])})),d=_.G("div#slider-range").append("svg").attr("viewBox","-10 0 320 50").append("g").attr("transform","scale(0.8, 1.2) translate(20,10)");d.call(u),d.select(".axis").attr("transform","translate(0, 0)").selectAll("text").attr("y",10),d.selectAll(".parameter-value").selectAll("text").attr("y",15),_.G("p#value-range").text("Time Range").style("text-align","right").style("margin-right","7px"),n.selectAll("*").remove();!function(t,e){var n=[];e.forEach((function(t){n.push({id:t,time:[]})})),t.forEach((function(t){t.messages.forEach((function(t){var e=n.findIndex((function(e){return e.id===t.push_userid}));if(-1!==e){var r=new Date(t.push_ipdatetime).getDate(),a=new Date(t.push_ipdatetime).getMonth(),i=new Date(t.push_ipdatetime).getHours(),c="".concat(a,"/").concat(r,"/").concat(i),o=n[e].time.findIndex((function(t){return t.pushTime===c}));-1!==o?n[e].time[o].reply.push(t):n[e].time.push({pushTime:c,month:a,hours:i,date:r,reply:[t]})}}))})),n.forEach((function(t){if(t.time[0]){var e=new Date("".concat(t.time[0].month,"/").concat(t.time[0].date)),n=new Date("".concat(t.time[t.time.length-1].month,"/").concat(t.time[t.time.length-1].date)),r=Math.abs(n-e),a=Math.ceil(r/864e5);t.totalDate=a}else t.totalDate=0}))}(t,e);for(var f=[_.n,_.r,_.p,_.s,_.t,_.v,_.o,_.q,_.n,_.r,_.p,_.s,_.t,_.v,_.o,_.q],p=_.F,h=(_.A().range([_.u(0),_.u(.8)]).domain([0,10]),_.E().domain([0,1440]).range([100,1e3]),_.E().domain([o,l]).range([0,c])),m=330,g=e.map((function(t){return t.id})),v=_.z().domain(g).range([0,m]),y=function(t,e){var n=new Date(t),r=new Date(e),a=Math.abs(r-n),i=Math.ceil(a/864e5),c=(n.getMonth(),n.getDate(),[]);c.push("".concat(n.getMonth()+1,"/").concat(n.getDate()));for(var o=0;o<i+3;o+=1){var l=new Date(n.setDate(n.getDate()+1));c.push("".concat(l.getMonth()+1,"/").concat(l.getDate()))}return c}(o,l),x=function(t){for(var e=[],n=0;n<t;n+=1)e.push(n);return e}(24),b=(_.z().range([0,288]).domain(x).padding(.05),_.z().range([0,12*y.length]).domain(y).padding(.05),_.G(".tooltip")),w=null,k=function(t){w=w?null:t.article_id,console.log("isClicked",w),b.style("opacity",0).style("left","0px").style("top","0px"),w&&C(t),A.selectAll(".repostLink").attr("opacity",w?0:1),A.selectAll(".pointer").attr("opacity",w?0:1),A.selectAll(".article").attr("opacity",w?0:1);var e=t.article_id.replace(/\./gi,"");A.selectAll(".pointer.articleID_".concat(e)).attr("opacity",1);var n=[];t.messages.forEach((function(t){g.includes(t.push_userid)&&(n.includes(t.push_userid)||n.push(t.push_userid))}));var r=_.A().domain([0,g.length]).range([0,-80]);if(A.selectAll(".pointer.articleID_".concat(e)).selectAll("rect").transition().duration(1e3).attr("width",w?-r(n.length)+v.range()[1]:-r(n.length)),console.log(t),w){var a=new Date(t.date).getFullYear(),i=t.messages.filter((function(t){return g.includes(t.push_userid)}));A.selectAll().data(i).enter().append("circle").attr("class","commentTime").attr("cx",(function(t){return v(t.push_userid)+v.bandwidth()/2})).attr("r",4).style("fill",(function(t){return P(t.push_tag)})).attr("opacity",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(a));return h(r)<c?1:0})).on("mouseover",(function(e){return D(t,e)})).on("mouseout",(function(e){return j(e,t.article_id)})).attr("cy",h(new Date(t.date))).transition().duration(1e3).attr("cy",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(a));return h(r)}))}else A.selectAll(".commentTime").remove()},D=function(t,e){if(!w||(t.article_id===w&&(Array.isArray(e)?C(t):(b.style("opacity",1).html('<p style="color: white;">'.concat(e.push_tag," ").concat(e.push_userid,": ").concat(e.push_content," ").concat(e.push_ipdatetime,"</p>")).style("left","".concat(_.j.pageX+25,"px")).style("top","".concat(_.j.pageY+25,"px")),_.G(i).style("stroke","black").style("opacity",1))),t===w))if(Array.isArray(e)){t.article_title;C(t),A.selectAll(".repostLink").attr("opacity","0"),A.selectAll(".pointer").attr("opacity","0"),A.selectAll(".article").attr("opacity","0");var n=t.article_id.replace(/\./gi,"");A.selectAll(".articleID_".concat(n)).attr("opacity","1");for(var r=0;r<e.length;r+=1)if("R"===t.article_title[0]){if(t.article_title.substring(4)===e[r].article_title){var a=e[r].article_id.replace(/\./gi,"");A.selectAll(".articleID_".concat(a)).attr("opacity","1"),A.selectAll(".repostLink.".concat(a)).attr("opacity","1")}}else if(t.article_title===e[r].article_title.substring(4)){var c=t.article_id.replace(/\./gi,""),o=e[r].article_id.replace(/\./gi,"");A.selectAll(".articleID_".concat(o)).attr("opacity","1"),A.selectAll(".repostLink.".concat(c)).attr("opacity","1")}}else b.style("opacity",1).html('<p style="color: white;">'.concat(e.push_tag," ").concat(e.push_userid,": ").concat(e.push_content," ").concat(e.push_ipdatetime,"</p>")).style("left","".concat(_.j.pageX+25,"px")).style("top","".concat(_.j.pageY+25,"px")),_.G(i).style("stroke","black").style("opacity",1)},j=function(t,e){console.log(t),w||(b.style("opacity",0).style("left","0px").style("top","0px"),A.selectAll(".repostLink").attr("opacity",1),A.selectAll(".article").attr("opacity",1),A.selectAll(".pointer").attr("opacity",1),_.G(i).style("stroke","none").style("opacity",.8))},A=n.append("g").attr("transform","translate(".concat(132,", 100)")),G=h.domain()[0];G<h.domain()[1];G=new Date(G).setDate(new Date(G).getDate()+1))new Date(G).getDay()>5||new Date(G).getDay()<1?A.selectAll().data([G]).enter().append("rect").attr("class","offday").attr("x",0).attr("y",(function(t){return h(new Date(t))})).attr("fill","lightgray").attr("width",v.range()[1]).attr("height",(function(t){var e=new Date(t),n=new Date(t);return e.setDate(e.getDate()+1),h(e)-h(n)})):(A.selectAll().data([new Date(new Date(new Date(G).setHours(0)).setMinutes(0)).setSeconds(0)]).enter().append("rect").attr("class","beforWork").attr("x",0).attr("y",(function(t){return h(new Date(t))})).attr("fill","lightgray").attr("width",v.range()[1]).attr("height",(function(t){var e=new Date(t),n=new Date(t);return e.setHours(e.getHours()+9),h(e)-h(n)})),A.selectAll().data([new Date(new Date(new Date(G).setHours(18)).setMinutes(0)).setSeconds(0)]).enter().append("rect").attr("class","afterWork").attr("x",0).attr("y",(function(t){return h(new Date(t))})).attr("fill","lightgray").attr("width",v.range()[1]).attr("height",(function(t){var e=new Date(t),n=new Date(t);return e.setHours(e.getHours()+6),h(e)-h(n)})));A.append("g").attr("class","xAxis").call(_.d(v).tickSizeInner([-c])).each((function(t,n,r){_.G(r[n]).selectAll("text").style("text-anchor","start").attr("font-size",14).attr("fill",(function(t){return f[e.find((function(e){return e.id===t})).community](.8)})).attr("dx","0.8em").attr("dy","0.5em").attr("transform","rotate(-45) translate(-5, -10)"),_.G(r[n]).append("text").text("User accounts").attr("stroke","black").attr("font-size","small").attr("transform","translate(".concat(v.range()[1]/2,", -70)"))})),A.append("g").attr("class","yAxis").call(_.b(h).ticks(_.I.every(1)).tickFormat(_.J("%m/%d")).tickSizeInner([100])).selectAll("path").attr("stroke-width","2px");var L=_.A().domain([0,100]).range([0,-80]);A.append("g").attr("class","xAxis").call(_.d(L).tickSizeOuter([0]).tickSizeInner([-c]).ticks(3).tickFormat((function(t){return"".concat(t)}))).each((function(t,e,n){_.G(n[e]).append("text").text("Reply rate(%)").attr("stroke","black").attr("font-size","small").attr("transform","translate(".concat(L.range()[1]/2,", -70)"));var r=180*Math.atan2(20,10)/Math.PI;_.G(n[e]).selectAll(".tick").selectAll("text").style("text-anchor","end").attr("font-size",14).attr("dx","0.8em").attr("dy","0.5em").attr("transform","rotate(".concat(r,") translate(-40, 0)")),_.G(n[e]).selectAll(".tick").append("line").attr("stroke","black").attr("x1",-10).attr("y1",-20).attr("x2",0).attr("y2",0)}));var M=A.append("g").attr("transform","translate(0, -30)");M.append("circle").attr("cx",-80).attr("cy",647).attr("r",5).attr("fill",f[0](.7)),M.append("text").text("Article").attr("x",-70).attr("y",652),M.append("circle").attr("cx",10).attr("cy",647).attr("r",5).attr("fill",P("\u63a8")),M.append("text").text("push").attr("x",20).attr("y",652),M.append("circle").attr("cx",70).attr("cy",647).attr("r",5).attr("fill",P("\u2192")),M.append("text").text("\u2192").attr("x",80).attr("y",652),M.append("circle").attr("cx",120).attr("cy",647).attr("r",5).attr("fill",P("\u5653")),M.append("text").text("boo").attr("x",130).attr("y",652),M.append("text").text("White area: weekday 9:00 - 18:00").attr("x",10).attr("y",672);_.A().domain([0,g.length]).range([0,10]);for(var E=_.A().domain([0,g.length]).range([0,-80]),S=t.sort((function(t,e){return new Date(t.date)-new Date(e.date)})).filter((function(t){return t.messages.some((function(t){return g.includes(t.push_userid)}))})),F=(_.A().domain([0,610]).range([-30,-100]),function(t){for(var e=function(e){if(!S[t].article_title||!S[e].article_title)return"break";if(S[t].article_title===S[e].article_title.substring(4)){var n=h(new Date(S[t].date)),r=h(new Date(S[e].date)),a=S[t].article_id.replace(/\./gi,""),i=S[e].article_id.replace(/\./gi,""),c=[];S[t].messages.forEach((function(t){g.includes(t.push_userid)&&(c.includes(t.push_userid)||c.push(t.push_userid))}));var o=[];S[e].messages.forEach((function(t){g.includes(t.push_userid)&&(o.includes(t.push_userid)||o.push(t.push_userid))}));var l=_.w().curve(_.f).x((function(t){return t.x})).y((function(t){return t.y}));A.append("path").attr("class","repostLink ".concat(a)).attr("id","".concat(a,"_").concat(i)).attr("d",l([{x:E(c.length),y:n},{x:Math.min(E(c.length)-20,E(o.length)-20),y:(n+r)/2},{x:E(o.length),y:r}])).attr("stroke","gray").attr("stroke-width","4px").attr("fill","none").on("mouseover",(function(){return function(t){if(!w){A.selectAll(".repostLink").attr("opacity","0"),A.selectAll(".article").attr("opacity","0"),A.selectAll(".pointer").attr("opacity","0");var e=t[0].replace(/\./gi,"");console.log(e),A.selectAll(".articleID_".concat(e)).attr("opacity","1");var n=t[1].replace(/\./gi,"");A.selectAll(".articleID_".concat(n)).attr("opacity","1"),A.selectAll("#".concat(e,"_").concat(n)).attr("opacity","1")}}([S[t].article_id,S[e].article_id])})).on("mouseout",j)}},n=t+1;n<S.length;n+=1){if("break"===e(n))break}}),N=0;N<S.length;N+=1)F(N);for(var T=function(e){if(t[e].messages.some((function(t){return g.includes(t.push_userid)}))){var n=t[e].article_id.replace(/\./gi,""),r=[];t[e].messages.forEach((function(t){g.includes(t.push_userid)&&(r.includes(t.push_userid)||r.push(t.push_userid))})),A.append("g").attr("class","pointer articleID_".concat(n)).attr("transform","translate(0, 0)").selectAll().data([t[e]]).enter().each((function(e,n,a){_.G(a[n]).append("rect").attr("y",(function(t){var e=new Date(t.date);return h(e)})).attr("opacity",(function(t){var e=new Date(t.date);return h(e)<c?1:0})).attr("x",E(r.length)).attr("width",-E(r.length)).attr("height",2).style("fill",f[0](.8)).on("mouseover",(function(e){return D(e,t)})).on("mouseout",j),_.G(a[n]).append("circle").attr("cy",(function(t){var e=new Date(t.date);return h(e)+1})).attr("opacity",(function(t){var e=new Date(t.date);return h(e)<c?1:0})).attr("cx",E(r.length)).attr("r",5).attr("stroke","black").attr("stroke-width",(function(t){return t.article_title&&"R"!==t.article_title[0]?"2px":"0px"})).style("fill",f[0](.8)).on("mouseover",(function(e){return D(e,t)})).on("mouseout",j).on("click",k)}));var a=new Date(t[e].date).getFullYear(),i=t[e].messages.filter((function(t){return g.includes(t.push_userid)}));A.append("g").attr("class","article articleID_".concat(n)).selectAll().data(i).enter().append("circle").attr("cy",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(a));return h(r)})).attr("opacity",(function(t,e){var n=H(t),r=new Date(new Date(n).setFullYear(a));return h(r)<c?1:0})).attr("cx",(function(t){return v(t.push_userid)+v.bandwidth()/2})).attr("r",4).style("fill",(function(t){return P(t.push_tag)})).attr("stroke","black").on("mouseover",(function(n){return D(t[e],n)})).on("mouseout",j).on("click",k)}},I=0;I<t.length;I+=1)T(I);function C(t){var e=new Date(t.date);b.style("opacity",1).html('<p style="color: white;">Title: '.concat(t.article_title,"<br>\n        Date: ").concat(e.getFullYear(),"/").concat(e.getMonth()+1,"/").concat(e.getDate()," ").concat(e.getHours(),":").concat(e.getMinutes(),'<br>\n        <a href="').concat(t.url,'" target="_blank" style="color: cornflowerblue;">Go To Post Page</a></p>')).style("left","".concat(_.j.pageX+25,"px")).style("top","".concat(_.j.pageY-130,"px"))}function H(t){var e="",n=t.push_ipdatetime.split(" ");return 3===n.length?e=(e=e.concat("",n[1])).concat(" ",n[2]):t.push_ipdatetime}function P(t){switch(t){case"\u63a8":return p[4];case"\u5653":return p[2];case"\u2192":return p[5];default:return"black"}}}n(156),n(158);var L=n(3),M=n(70),E=n.n(M);function S(t,e){if(!t)return!1;e.map((function(t){return t.weight=10*t.value,t}));for(var n=[],r=0;r<t.length;r+=1)n.push(r);var a;a=e.map((function(e){return{source:t.findIndex((function(t){return t===e.source})),target:t.findIndex((function(t){return t===e.target})),weight:e.weight}}));var i=E()().nodes(n).edges(a),c=_.i(t),o=_.l().force("link",_.k().id((function(t){return t.key})));o.nodes(c),o.force("link").links(a);for(var l=i(),s=[],u=Object.keys(l),d=0;d<u.length;d+=1)s.push({id:t[u[d]],community:l[u[d]]});for(var f=function(t){for(var e=[],n=function(t){var n=e.find((function(e){return e.community===s[t].community}));n?n.count+=1:e.push({community:s[t].community,count:1})},r=0;r<s.length;r+=1)n(r);if(console.log("communityCount: ".concat(e.length," mergeCount: ").concat(t+1)),!(e.length>50))return"break";var a=e.filter((function(e){return e.count<=t+1}));s.forEach((function(t){t.community=a.some((function(e){return e.community===t.community}))?a[0].community:t.community}))},p=0;p<100;p+=1){if("break"===f(p))break}return s}function F(t,e,n,r,a,i,c){var o=_.D().domain([0,200]).range([.5,.1]),s=_.G("#context");parseFloat(_.G(".heatMap").style("height"));r.selectAll("*").remove();var u=30,d=30,f=1300-d-30,p=450-u-60,h=[_.n,_.r,_.p,_.s,_.t,_.v,_.o,_.q,_.n,_.r,_.p,_.s,_.t,_.v,_.o,_.q],m=function(t){return _.F[t]},g=_.A().range(["white",m(9)]).domain([0,100]),v=function(t){_.A().domain([0,2]).range([1,0]);for(var e=[],n=function(n){for(var r=t[n].repliedArticle,a=function(a){var i=t[a].repliedArticle,c=r.filter((function(t){return 0===i.filter((function(e){return e.article_id===t.article_id})).length})),o=i.filter((function(t){return 0===r.filter((function(e){return e.article_id===t.article_id})).length})),l=r.length-c.length,s=(i.length,o.length,l/(r.length+i.length-l));e.push({source:t[n].id,target:t[a].id,value:s})},i=n+1;i<t.length;i+=1)a(i)},r=0;r<t.length-1;r+=1)n(r);return e}(n),y=[],x=[],b=[],w=[],j=a.slice();function A(a,c,v){var A=this;y=[],r.selectAll("*").remove(),r.call(_.M().extent([[0,0],[f,p]]).scaleExtent([.1,8]).on("zoom",(function(){O.attr("transform",_.j.transform)})));var O=r.append("g").attr("class","position").append("g").attr("class","group").attr("transform","translate(-30, 200)");var M=function(t,e,n,r,a){var i=t.filter((function(t){return t.repliedArticle.length>a})),c=t.map((function(t){return t.id})),o=function(t){return t.value<r},l=n.filter((function(t){return c.includes(t.source)&&c.includes(t.target)}));c.forEach((function(t){l.filter((function(e){return e.source===t||e.target===t})).filter((function(t){return t.source!==t.target})).every(o)&&(l=l.filter((function(e){return!(e.source===t||e.target===t)})),i=(i=i.filter((function(e){return e.id!==t}))).filter((function(e){return e!==t})))}));var s=i,u=s.map((function(t){return t.id})),d=l.filter((function(t){return s.some((function(e){return e.id===t.source}))&&s.some((function(e){return e.id===t.target}))}));return[s,u,d]}(n,0,a,c,v),E=Object(D.a)(M,3);if(x=E[0],b=E[1],w=E[2],console.log("[datas]:",[x],"[users]:",[b],"[similaritys]:",[w]),x.length){for(var F=[],N=0;N<b.length;N+=1)F.push(N);console.log("Similarity: ",w.length);var T=S(b,w);T.forEach((function(t){x.find((function(e){return e.id===t.id})).community=t.community}));var I=function(t){if(!t[0].titleWordScore)return[];for(var e=[],n=Math.max.apply(Math,Object(k.a)(t.map((function(t){return t.community}))))+1,r=0;r<n;r+=1)e.push({community:r,wordList:[]});return t.forEach((function(t){var n=e.find((function(e){return e.community===t.community})),r=t.titleWordScore.filter((function(t,e){return e<50})).reduce((function(t,e){return t+e.score}),0),a=t.repliedArticle;t.titleWordScore.every((function(e,i){var c=0,o=0,l=0;a.forEach((function(n){if(n.cuttedTitle.some((function(t){return t.word===e.word}))){var r=n.messages.filter((function(e){return e.push_userid===t.id}));c+=r.filter((function(t){return"\u63a8"===t.push_tag})).length,o+=r.filter((function(t){return"\u5653"===t.push_tag})).length,l+=r.filter((function(t){return"\u2192"===t.push_tag})).length}}));var s=n.wordList.find((function(t){return t.word===e.word}));return s?(s.score+=e.score/r,s.push+=c,s.boo+=o,s.neutral+=l):n.wordList.push({word:e.word,score:e.score/r,push:c,boo:o,neutral:l}),i<49}))})),e.forEach((function(e){var n=t.filter((function(t){return t.community===e.community})).length;e.wordList.forEach((function(t){t.score=Math.round(t.score/n*1e3)/1e3,t.push=Math.round(t.push/n*1e3)/1e3,t.boo=Math.round(t.boo/n*1e3)/1e3,t.neutral=Math.round(t.neutral/n*1e3)/1e3}))})),e.forEach((function(t){t.wordList.sort((function(t,e){return e.score-t.score}))})),e}(x);if(I.length)I[0].wordList.reduce((function(t,e){return t+e.score}),0);var C=function(t){var e=[];t.forEach((function(t){t.repliedArticle.forEach((function(n){var r=e.find((function(t){return t.article_id===n.article_id}));r?r.userCommuniy.push(t.community):e.push(Object(l.a)(Object(l.a)({},n),{},{userCommuniy:[t.community]}))}))}));for(var n=[],r=0;r<e.length;r+=1)for(var a=JSON.parse(JSON.stringify(e[r])),i=function(t){var r=JSON.parse(JSON.stringify(e[t])),i=[],c=[];a.userCommuniy.forEach((function(t){var e=r.userCommuniy.findIndex((function(e){return e===t}));c.push(t),e>=0&&(i.push(t),r.userCommuniy.splice(e,1))})),c.push.apply(c,Object(k.a)(r.userCommuniy));var o=i.length/c.length;o&&n.push({source:a.article_id,target:r.article_id,value:o})},c=r+1;c<e.length;c+=1)i(c);return[e,n]}(x),H=Object(D.a)(C,2),P=H[0],R=H[1];console.log("articleSimilarity: ",R.length);var z=S(P.map((function(t){return t.article_id})),R),J=function(t,e){for(var n=[],r=[],a=0;a<e.length;a+=1)n.push(Array(e.length).fill(1)),r.push(Array(e.length).fill(1));return t.forEach((function(t){var a=e.findIndex((function(e){return e===t.source})),i=e.findIndex((function(e){return e===t.target}));n[a][i]=t.value,n[i][a]=t.value,r[a][i]=t.value,r[i][a]=t.value})),[n,r]}(w,b),Y=Object(D.a)(J,2),q=Y[0],U=Y[1],B=(_.C().exponent(.5).range([0,100]),function(t,e,n,r,a){for(var i=0;i<r.length;i+=1)n.push(Array(r.length).fill(""));L.mat2graph(t);for(var c=L.pca_order(t),o=L.mat2graph(e),l=(L.spectral_order(o),Object(k.a)(r)),s=0;s<r.length;s+=1)n[s]=l[c[s]];l=Object(k.a)(n);var u=L.permute(t,c);u=L.transpose(u),u=L.permute(u,c),u=L.transpose(u);var d=L.permute(e,c);d=L.transpose(d),d=L.permute(d,c),d=L.transpose(d);for(var f=function(t){for(var e=function(e){var r=JSON.parse(JSON.stringify(d[t][e])),i=a.find((function(e){return e.id===n[t]})).community,c=i===a.find((function(t){return t.id===n[e]})).community?i+1:0;d[t][e]={com:c,value:r}},r=0;r<d.length;r+=1)e(r)},p=0;p<d.length;p+=1)f(p);return[u,d]}(q,U,y,b,T)),W=Object(D.a)(B,2),Q=W[0],X=W[1],$=function(t,e,n,r,a){for(var i=Math.max.apply(Math,Object(k.a)(n.map((function(t){return t.community}))))+1,c=[],o=[],l=0;l<t.length;l+=1)c.push(l);for(var s=0;s<t.length;s+=1)o.includes(e[s][s].com-1)||o.push(e[s][s].com-1);for(var u=0,d=0;d<i;d+=1)for(var f=0;f<t.length;f+=1)o[d]===e[f][f].com-1&&(c[u]=f,u+=1);for(var p=r.slice(),h=0;h<a.length;h+=1)r[h]=p[c[h]];var m=L.permute(t,c);m=L.transpose(m),m=L.permute(m,c),m=L.transpose(m);var g=L.permute(e,c);return g=L.transpose(g),g=L.permute(g,c),[m,g=L.transpose(g)]}(Q,X,T,y,b),K=Object(D.a)($,2),V=K[0],Z=K[1],tt=[];y.forEach((function(t,e){var n=T.find((function(e){return e.id===t})).community,r=tt.find((function(t){return t.community===n}));r?r.num+=1:tt.push({community:n,num:1,index:e})}));_.G(".position").attr("transform","scale(1) translate(".concat(2*d,",").concat(4*u,")"));var et=O.append("g").attr("class","leftSvg").attr("transform","rotate(-45) scale(".concat(o(x.length)>0?o(x.length):.4,") translate(0,0)"));_.G(".tooltip").remove();var nt=_.G(".heatMap").append("div").style("opacity",0).attr("class","tooltip").style("background-color","black").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px"),rt=function(t){"string"===typeof t&&_.H("circle.".concat(t)).attr("r",3),nt.style("opacity",0).style("left","0px").style("top","0px"),_.G(A).style("stroke","none").style("opacity",.8)},at=[],it=function(t,e,n){var r=[],a=_.G("#userDate1").property("value"),c=_.G("#userDate2").property("value"),o=x.filter((function(t){return j.includes(t.id)}));2===o.length?r=o[0].repliedArticle.filter((function(t){return o[1].repliedArticle.some((function(e){return t.article_id===e.article_id}))})):o.forEach((function(t){t.repliedArticle.forEach((function(t){r.some((function(e){return e.article_id===t.article_id}))||r.push(t)}))}));var l=[];y.forEach((function(t){var e=o.find((function(e){return e.id===t}));e&&l.push(e)})),G(r=at.length>=1?at:r,l,s,a,c),i.sort((function(t,e){return r.find((function(t){return t.article_title===e.article_title}))?1:-1})),console.log("sorted articles",i),console.log("bothRepliedArticles",r)},ct=_.G("#timeLine").append("g").attr("class","groupLegends").attr("transform","translate(".concat(d,", ").concat(u,")"));ct.selectAll("rect").data(tt).enter().append("g").attr("class",(function(t,e){return"group_".concat(e)})).attr("transform",(function(t,e){return"translate(".concat(e%2*110,", ").concat(70*Math.floor(e/2),")")})).each((function(t,e,n){_.G(n[e]).append("text").text("Community ".concat(e+1)).attr("x",0).attr("font-size",14).attr("fill",h[t.community](1)),_.G(n[e]).selectAll().data([1,.8,.6,.4,.2]).enter().append("rect").attr("x",(function(t,e){return 15*e})).attr("y",10).attr("width",15).attr("height",15).attr("fill",(function(e){return h[t.community](e)})),_.G(n[e]).selectAll().data(["1",".8",".6",".4",".2"]).enter().append("text").text((function(t){return t})).attr("x",(function(t,e){return 15*e+5})).attr("y",35).attr("font-size",10).attr("fill","black")}));var ot=20,lt=Math.max.apply(Math,Object(k.a)(x.map((function(t){return t.repliedArticle.length})))),st=80,ut=70,dt=_.D().domain([0,lt]).range([0,ut]),ft=function(t,e){for(var n=[],r=0,a=function(a){if(n.push(r),a<t.length){var i=t.find((function(t){return t.id===y[a]}));r+=e(i.repliedArticle.length)}},i=0;i<=t.length;i+=1)a(i);return n}(x,dt);!function(){for(var n=function(t){var e=et.append("g");e.selectAll().data(V[t]).enter().each((function(e,n,r){if(n>=t){var i=x.find((function(t){return t.id===y[n]})),c=x.find((function(e){return e.id===y[t]}));if(t<n||i.community===c.community){x.find((function(t){return t.id===i.id})).repliedArticle.length,x.find((function(t){return t.id===c.id})).repliedArticle.length;var o=(v=c,i.repliedArticle.filter((function(t){return v.repliedArticle.some((function(e){return e.article_id===t.article_id}))}))),l=o.length;d=r,f=n,p=t,_.G(d[f]).append("rect").attr("class",(function(){var t=y[f],e=y[p];return"userRect ".concat(t," ").concat(e," y").concat(p," x").concat(f)})).attr("x",f%y.length*100).attr("y",100*p).attr("width",st).attr("height",st).attr("fill","white").attr("stroke",h[7](1)).attr("stroke-width","2px").attr("opacity",p>f?0:1),function(t,e,n,r,a,i,c){_.G(e[n]).append("rect").attr("class",(function(){var t=y[n],e=y[r];return"articleSimilarity ".concat(t," ").concat(e," y").concat(r," x").concat(n)})).attr("x",n%y.length*100+5).attr("y",100*r+5).attr("rx",(function(){return r>n?0:Math.min(15,dt(c)/10)})).attr("width",ut).attr("height",ut).attr("fill",(function(){if(r>n)return g(100);if(a.community===i.community){_.A().range(["white",m(a.community)]).domain([0,1]);return h[a.community](.2*Math.floor(100*t/20))}return h[7](.2*Math.floor(100*t/20))})).attr("opacity",r>=n?0:1).on("mouseover",(function(){return function(t,e,n){"string"===typeof t&&_.H("circle.id_".concat(t)).attr("r",10);var r=y[e],a=y[n];nt.style("opacity",1).html('<p style="color: white;">Similarity between '.concat(r," and ").concat(a," is ").concat(Math.round(100*t.value)/100,"</p>")).style("left","".concat(_.j.pageX+25,"px")).style("top","".concat(_.j.pageY,"px")),_.G(A).style("stroke","black").style("opacity",1)}(Z[r][n],n,r)})).on("mouseout",rt).on("click",(function(){j.splice(0,j.length),j.push(y[r]),j.push(y[n]),it()}))}(e,r,n,t,i,c,l);var s=_.G("#replyQuantile"),u=s.empty()?null:s.property("checked");t!==n&&!1!==u||function(t,e,n,r,i,c){var o=a(r,c),l=a(i,c);r.id===i.id&&(x.find((function(t){return t.id===r.id})).replyTime=o);var s=10,u=70;_.G(t[e]).selectAll().data([o,l]).enter().append("g").attr("class",(function(){return r.id===i.id?"userSelf quantilePath":"betweenUsers quantilePath"})).each((function(t,a,c){var o=[Math.max(0,_.y(t,.25)),Math.max(0,_.y(t,.5)),Math.max(0,_.y(t,.75))];_.G(c[a]).selectAll().data([[o[0],o[2]],o[1]]).enter().append("path").attr("d",(function(t,r){var i=100*(e%y.length+1)-ot-s/2,c=100*n+s/2;if(0===r){var o=t[0]/60,l=Math.min(2*u,o/360*u*2),d=t[1]/60,f=Math.min(2*u,d/360*u*2);if(f<=u)return"\n                      M ".concat(i-a%2*l," ").concat(c+(a+1)%2*l," \n                      L ").concat(i-a%2*f," ").concat(c+(a+1)%2*f,"\n                      L ").concat(i-a%2*f+(a+1)%2*s," ").concat(c+(a+1)%2*f-a%2*s," \n                      L ").concat(i-a%2*l+(a+1)%2*s," ").concat(c+(a+1)%2*l-a%2*s," \n                      L ").concat(i-a%2*l," ").concat(c+(a+1)%2*l," \n                    ");if(f>u&&l<u){if(0===a){var p=f-u;return"\n                      M ".concat(i," ").concat(c+(a+1)%2*l," \n                      L ").concat(i," ").concat(c+u," \n                      L ").concat(i-p," ").concat(c+u," \n                      L ").concat(i-p," ").concat(c+u+s," \n                      L ").concat(i+s," ").concat(c+u+s,"\n                      L ").concat(i+s," ").concat(c+(a+1)%2*l," \n                      L ").concat(i," ").concat(c+(a+1)%2*l," \n                      ")}var h=f-u;return"\n                      M ".concat(i-a%2*l," ").concat(c," \n                      L ").concat(i-u," ").concat(c," \n                      L ").concat(i-u," ").concat(c+h," \n                      L ").concat(i-u-s," ").concat(c+h," \n                      L ").concat(i-u-s," ").concat(c-s," \n                      L ").concat(i-a%2*l," ").concat(c-s," \n                      L ").concat(i-a%2*l," ").concat(c," \n                    ")}if(f>u&&l>u){if(0===a){var m=f-u;return"\n                        M ".concat(i-(l-u)," ").concat(c+u," \n                        L ").concat(i-m," ").concat(c+u," \n                        L ").concat(i-m," ").concat(c+u+s," \n                        L ").concat(i-(l-u)," ").concat(c+u+s," \n                        L ").concat(i-(l-u)," ").concat(c+u," \n                        ")}var g=f-u;return"\n                      M ".concat(i-u," ").concat(c+(l-u)," \n                      L ").concat(i-u," ").concat(c+g,"\n                      L ").concat(i-u-s," ").concat(c+g,"\n                      L ").concat(i-u-s," ").concat(c+(l-u),"\n                      L ").concat(i-u," ").concat(c+(l-u),"\n                    ")}}var v=t/60,x=Math.min(2*u-1,v/360*u*2);return x<=u?0===a?"\n                      M ".concat(i," ").concat(c+x," \n                      L ").concat(i," ").concat(c+(x+1)," \n                      L ").concat(i+s," ").concat(c+(x+1)," \n                      L ").concat(i+s," ").concat(c+x," \n                      "):"\n                    M ".concat(i-x," ").concat(c," \n                    L ").concat(i-(x+1)," ").concat(c," \n                    L ").concat(i-(x+1)," ").concat(c-s," \n                    L ").concat(i-x," ").concat(c-s," \n                    "):0===a?"\n                    M ".concat(i-(x-u)," ").concat(c+u," \n                    L ").concat(i-(x-u+1)," ").concat(c+u,"\n                    L ").concat(i-(x-u+1)," ").concat(c+u+s,"\n                    L ").concat(i-(x-u)," ").concat(c+u+s,"\n                    "):"\n                  M ".concat(i-u," ").concat(c+(x-u)," \n                  L ").concat(i-u," ").concat(c+(x-u+1),"\n                  L ").concat(i-u-s," ").concat(c+(x-u+1),"\n                  L ").concat(i-u-s," ").concat(c+(x-u),"\n                  ")})).attr("fill",(function(){return 0===a?h[r.community](V[e][n]):h[i.community](V[e][n])})).attr("stroke",(function(t,e){return"black"})).attr("stroke-width",(function(t,e){return"3px"}))}))}(r,n,t,i,c,o)}}var d,f,p,v})),function(t,e){var n=T.find((function(t){return t.id===y[e]}));t.append("path").attr("d",(function(){var t=x.find((function(t){return t.id===n.id})).repliedArticle.length,r=(dt.range()[1]-dt(t))/2+5,a=100*e+r,i=a+dt(t);return"M ".concat(a," ").concat(a," L ").concat(i," ").concat(a," L ").concat(i," ").concat(i," L ").concat(a," ").concat(i," L ").concat(a," ").concat(a)})).attr("fill",h[n.community](.8)).on("click",(function(){j.splice(0,j.length),j.push(y[e]),it()}))}(e,t)},r=0;r<Q.length;r+=1)n(r);function a(t,e){var n=[];return e.forEach((function(e){var r=new Date(e.date).getFullYear(),a=function(t){var e="",n=t.push_ipdatetime.split(" ");if(3===n.length)return e=(e=e.concat("",n[1])).concat(" ",n[2]);return t.push_ipdatetime}(e.messages.find((function(e){return e.push_userid===t.id}))),i=new Date(new Date(a).setFullYear(r))-new Date(e.date);n.push(i/1e3)})),n.sort((function(t,e){return t-e})),n}!function(){var n=o(x.length)>0?o(x.length):.4,r=100*x.length-ot,a=_.e().extent([[0,0],[r*n*Math.sqrt(2),20]]).on("end",(function(r){if(!_.j.sourceEvent||"zoom"!==_.j.sourceEvent.type){var a=_.j.selection;j.splice(0,j.length);for(var c=Math.round(a[0]/n/(100*Math.sqrt(2))),o=Math.floor(a[1]/n/(100*Math.sqrt(2))),l=c;l<=o;l+=1)_.H("circle.id_".concat(y[l])).attr("r",7.5),j.push(y[l]);var u=100*c*n*Math.sqrt(2),d=(100*o+st)*n*Math.sqrt(2);_.G(".brush").nodes()[0].__brush.selection[0][0]=u,_.G(".brush").nodes()[0].__brush.selection[1][0]=d,i.select(".handle.handle--w").attr("x",u).attr("fill","slategray"),i.select(".handle.handle--e").attr("x",d).attr("fill","slategray"),i.select(".selection").attr("x",u).attr("width",d-u);var f=st*n;_.G(".brush").select("path").transition().attr("d",(function(){return"\n                M ".concat(u," ").concat(-f," \n                L ").concat((d+u)/2," ").concat(-(d-u)/2-f," \n                L ").concat(d," ").concat(-f," \n                L ").concat(u," ").concat(-f,"\n              ")})).attr("stroke","black").attr("stroke-width","2px").attr("fill","gray").attr("opacity","0.5").style("pointer-events","none"),function(n){var r=t,a=e,i=[],c=x.filter((function(t){return j.includes(t.id)}));c.forEach((function(t){t.repliedArticle.forEach((function(t){i.some((function(e){return e.article_id===t.article_id}))||i.push(t)}))}));var o=[];y.forEach((function(t){var e=c.find((function(e){return e.id===t}));e&&o.push(e)})),at.length>0?G(at,o,s,r,a):G(i,o,s,r,a),console.log("tickclick")}()}}));et.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",f).attr("height",p);var i=O;i.append("g").attr("class","brush").attr("transform","translate(0, ".concat(st*n,")")).call(a).call(a.move,[0,0]).on("mouseover",(function(){_.H(".avgSimilarityPath").attr("opacity",0)})).on("mouseout",(function(){_.H(".avgSimilarityPath").attr("opacity",1)})),i.select(".handle.handle--n").attr("fill","slategray"),i.select(".handle.handle--s").attr("fill","slategray"),_.G(".brush").append("path").attr("d","M 0 0 L 0 0 L 0 0")}()}(),function(){for(var t=O.append("g").attr("class","radialGroup").attr("transform","translate(0, ".concat(100,") scale(").concat(o(x.length)>0?o(x.length):.4,")")).attr("stroke","slategray").attr("stroke-width","0.3px"),e=Math.max.apply(Math,Object(k.a)(z.map((function(t){return t.community}))))+1,n=[],r=function(t){var e=z.filter((function(e){return e.community===t}));e.length&&n.push({community:t,articles:e})},a=0;a<e;a+=1)r(a);n.sort((function(t,e){return e.articles.length-t.articles.length}));var c=[];n.forEach((function(t){c.push(t.community)}));_.x().value((function(t){return t.length})).sort(null)(n);for(var l=Math.max.apply(Math,Object(k.a)(T.map((function(t){return t.community}))))+1,s=[],u=[],d=function(t){var e=x.find((function(e){return e.id===y[t]})).community;u.includes(e)||(u.push(e),s.push(t))},f=0;f<y.length;f+=1)d(f);for(var p=_.A().domain([0,P.length]).range([0,2e3]),m=[],g=[0],v=function(t){if(m.push(t),t<e-1){var r=n.find((function(e){return e.community===t}));r?g.push(2+g[t]+p(r.articles.length)):g.push(0)}},b=0;b<e;b+=1)v(b);for(var w=[],D=0;D<l;D+=1){var j=0;j=D===l-1?y.length-s[D]:s[D+1]-s[D];var A=G(D,j);w.push(A)}function G(t,e){var n=x.filter((function(e){return e.community===t})),r=function(){var t=[];return n.forEach((function(e){e.repliedArticle.forEach((function(e){var r=z.find((function(t){return t.id===e.article_id}));if(r){var a=t.find((function(t){return t.community===r.community}));if(a){var i=a.articles.find((function(t){return t.article_id===r.id}));i?i.count+=1/n.length:a.articles.push({article_id:r.id,count:1/n.length})}else t.push({community:r.community,articles:[{article_id:r.id,count:1/n.length}]})}}))})),t.sort((function(t,e){return e.articles.length-t.articles.length})),t}(),a=[];r.forEach((function(t){var e=t.articles.filter((function(t){return t.count>0})),n=t.articles.filter((function(t){return t.count>=.2})),r=t.articles.filter((function(t){return t.count>=.4})),i=t.articles.filter((function(t){return t.count>=.6})),c=t.articles.filter((function(t){return t.count>=.8}));a.push({community:t.community,level:[e,n,r,i,c]})}));ft.length;return s[t+1]&&s[t+1],a}!function(e){for(var r=[],a=n.reduce((function(t,e){return t+e.articles.length}),0),c=_.A().domain([0,a]).range([0,x.length*st]),o=0;o<n.length;o+=1){var l=o<=0?0:r[o-1].position;o>0?r.push({community:n[o].community,position:l+1.5*c(n[o-1].articles.length)}):r.push({community:n[o].community,position:l})}for(var d=0;d<e.length;d+=1){var f=t,p=s[d],m=(100*((s[d+1]?s[d+1]:ft.length-1)-p)-ot)*Math.sqrt(2);g(f,d,m),v(f,d,m),y(f,d)}function g(t,e,a){var i=s[e];t.append("g").attr("class","co-cluster_".concat(e)).selectAll("path").data(r).enter().append("rect").attr("class",(function(t){return"blank_group_".concat(t.community)})).attr("x",(function(){return 100*i*Math.sqrt(2)})).attr("y",(function(t){return t.position})).attr("height",(function(t){var e=n.find((function(e){return e.community===t.community})).articles;return c(e.length)})).attr("width",a).attr("fill","gray").attr("stroke","black")}function v(t,a,o){var l=s[a],d=u[a];t.append("g").attr("class","co-cluster_".concat(a)).selectAll("path").data(e[d]).enter().append("g").each((function(e,s,u){_.G(u[s]).selectAll("path").data(e.level).enter().append("rect").attr("x",(function(t,e){return 100*l*Math.sqrt(2)})).attr("y",(function(t,n){return r.find((function(t){return t.community===e.community})).position})).attr("height",(function(t){var r=n.find((function(t){return t.community===e.community})).articles;return c(r.length)})).attr("width",(function(t){var r=n.find((function(t){return t.community===e.community})).articles;return _.A().domain([0,r.length]).range([0,o])(e.level[0].filter((function(e){return t.some((function(t){return t.article_id===e.article_id}))})).length)})).attr("stroke","black").attr("fill",(function(t,e){return h[d](.2*(e+1))})).on("click",(function(e,n,r){at.splice(0,at.length),"10px"===_.G(r[n]).attr("stroke-width")?t.selectAll("rect").attr("stroke-width","3px"):(t.selectAll("rect").attr("stroke-width","3px"),_.G(r[n]).attr("stroke-width","10px"),i.forEach((function(t){e.some((function(e){return e.article_id===t.article_id}))&&at.push(t)}))),it()})).on("mouseover",(function(t){return e=t,n=a,void x.filter((function(t){return t.community===n})).forEach((function(t){t.haveReplied=t.repliedArticle.filter((function(t){return e.some((function(e){return e.article_id===t.article_id}))}))}));var e,n})).each((function(){}))}))}function y(t,a){for(var o=a,l=0,d=u[a],f=0;f<e.length;f+=1)a!==f?function(){var a=u[f];o+=l,l=0;var p=o,m=s[f],g=(100*((s[f+1]?s[f+1]:ft.length-1)-m)-ot)*Math.sqrt(2);e[f].reduce((function(t,e){return t+e.level[0].length}),0),t.append("g").attr("class","co-cluster_".concat(d,"_").concat(a)).selectAll("path").data(e[d]).enter().append("g").each((function(o,l,s){var u=o.community,f=e[a].find((function(t){return t.community===u}));_.G(s[l]).selectAll("path").data([1]).enter().append("rect").attr("x",(function(t){return 100*m*Math.sqrt(2)})).attr("y",(function(t,a){if(f){var i=n.find((function(t){return t.community===f.community})).articles.length,o=c(i)+(p-1)*(c(i)/2/e.length);return r.find((function(t){return t.community===f.community})).position+o}return 0})).attr("height",(function(t,r){if(f){var a=n.find((function(t){return t.community===f.community})).articles.length;return c(a)/2/e.length}return 0})).attr("width",(function(t){if(!f)return 0;var e=n.find((function(t){return t.community===f.community})).articles,r=_.A().domain([0,e.length]).range([0,g])(f.level[0].length);return _.A().domain([0,f.level[0].length]).range([0,r]),r})).attr("fill","none").attr("stroke","black"),_.G(s[l]).selectAll("path").data(o.level).enter().append("rect").attr("x",(function(t){return 100*m*Math.sqrt(2)})).attr("y",(function(t,a){if(f){var i=n.find((function(t){return t.community===f.community})).articles.length,o=c(i)+(p-1)*(c(i)/2/e.length);return r.find((function(t){return t.community===f.community})).position+o}return 0})).attr("height",(function(t,r){if(f){var a=n.find((function(t){return t.community===f.community})).articles.length;return c(a)/2/e.length}return 0})).attr("width",(function(t){if(!f)return 0;var e=n.find((function(t){return t.community===f.community})).articles,r=_.A().domain([0,e.length]).range([0,g])(f.level[0].length);return _.A().domain([0,f.level[0].length]).range([0,r])(f.level[0].filter((function(e){return t.some((function(t){return t.article_id===e.article_id}))})).length)})).attr("fill",(function(t,e){return h[d](.25*e)})).attr("stroke","black").attr("stroke",(function(t,e){return 0===e?"black":"none"})).on("click",(function(e,n,r,a){if(!f)return 0;var c=f.level[0].filter((function(t){return e.some((function(e){return e.article_id===t.article_id}))}));return at.splice(0,at.length),"10px"===_.G(r[n]).attr("stroke-width")?t.selectAll("rect").attr("stroke-width","1px"):(t.selectAll("rect").attr("stroke-width","1px"),_.G(r[n]).attr("stroke-width","10px"),i.forEach((function(t){c.some((function(e){return e.article_id===t.article_id}))&&at.push(t)}))),console.log("selectedArticles: ",at),console.log(c),it(),0}))}))}():l=1}t.selectAll("rect").attr("stroke-width","5px")}(w)}()}else r.append("text").text("No users meet the conditions. Please adjust the filter value").attr("x",100).attr("y",p/2).attr("font-size",20).attr("fill","red")}!function(){_.G(".option").selectAll("*").remove();var t=_.G(".option").append("div").style("padding","0px").style("padding-left","10px").attr("class","col-sm-3").style("display","flex").append("div").style("display","flex").style("margin-left","auto").style("margin-right","0px").style("align-items","center");t.append("h6").text("Similarity >=").style("margin-right","10px").style("margin-top","auto").style("margin-bottom","auto"),t.append("input").attr("type","number").attr("id","similarThresh").style("width","50px").style("height","fit-content").attr("value",.2);var e=_.G(".option").append("div").style("padding","0px").attr("class","col-sm-3").style("display","flex").append("div").style("display","flex").style("margin-left","auto").style("margin-right","0px").style("align-items","center");e.append("h6").text("Reply >=").style("margin-right","10px").style("margin-top","auto").style("margin-bottom","auto"),e.append("input").attr("type","number").attr("id","articleThresh").style("width","50px").style("height","fit-content").attr("value",1),_.G(".option").append("div").style("padding-left","10px").attr("class","col-sm-1").style("display","flex").append("button").style("type","button").style("font-size","smaller").attr("class","btn btn-primary").attr("id","submitUsers").text("Filter").on("click",(function(){var t=_.G("#similarThresh").property("value"),e=_.G("#articleThresh").property("value");A(v,t,e)})),A(v,.2,1)}(),function(){var n=_.G(".heatMap").select(".option").append("div").attr("class","col-sm-5 filterDiv d-flex align-items-center");(n=n.append("div").style("margin-right","0px").style("margin-left","auto").style("align-self","center").style("display","flex").style("font-size","x-small")).append("h6").text("Options:").style("margin-top","auto").style("margin-bottom","auto");var r=(n=n.append("div").style("margin-left","10px")).append("div").style("float","left").style("display","flex");r.append("input").attr("type","checkbox").attr("id","fiveLevel").attr("name","similarity").attr("value","fiveLevel").property("checked",!0),r.append("label").attr("for","fiveLevel").text("5-Level").style("margin-right","10px").style("margin-bottom","0px");var a=n.append("div").style("float","left").style("display","flex");a.append("input").attr("type","checkbox").attr("id","replyQuantile").attr("name","similarity").attr("value","replyQuantile").property("checked",!0),a.append("label").attr("for","replyQuantile").text("Quantile").style("margin-right","0px").style("margin-bottom","0px");var i=_.G(".option").append("div").style("padding-left","10px").style("margin-bottom","5px").style("margin-top","5px");i.append("span").style("margin-left","5px").style("margin-right","5px").text("From"),i.append("input").attr("type","date").attr("name","since").attr("id","userDate1").each((function(e,n,r){_.G(r[n]).property("value",t)})).attr("placeholder","since"),i.append("span").style("margin-left","5px").style("margin-right","5px").text("to"),i.append("input").style("margin-right","5px").attr("type","date").attr("name","until").attr("id","userDate2").each((function(t,n,r){_.G(r[n]).property("value",e)})).attr("placeholder","until"),i.append("button").style("type","button").style("font-size","smaller").attr("class","btn btn-primary").attr("id","submitUsers").text("Get Activity!").on("click",(function(t){var e=[];j.forEach((function(t){e.push({id:t})})),c(e,0)})),n.selectAll("input").on("change",(function(t,e,n){var r=_.G(n[e]).attr("value"),a=_.G(n[e]).property("checked");switch(r){case"userArticle":_.H(".articleSimilarity").attr("visibility",a?"visible":"hidden");break;case"userAuthor":_.H(".authorSimilarity").attr("visibility",a?"visible":"hidden");break;case"community":_.H(".avgSimilarityPath").attr("visibility",a?"visible":"hidden");break;case"quantile":_.H(".quantilePath").attr("visibility",a?"visible":"hidden");break;case"fiveLevel":_.G(".leftSvg").selectAll(".articleSimilarity").attr("fill",(function(t,e,n){var r=_.G(n[e]).attr("class");console.log(r);var i=r.split(" ")[1],c=r.split(" ")[2];console.log(i,c);var o=x.find((function(t){return t.id===i})),l=x.find((function(t){return t.id===c}));return o.community===l.community?a?(console.log("checked"),h[o.community](.2*Math.floor(100*t/20))):h[o.community](t):a?(console.log("checked"),h[7](.2*Math.floor(100*t/20))):h[7](t)}));break;case"replyQuantile":_.H(".betweenUsers.quantilePath").attr("visibility",a?"hidden":"visible");var i=_.G("#similarThresh").property("value"),c=_.G("#articleThresh").property("value");A(v,i,c)}}))}()}var N=function(t){Object(f.a)(n,t);var e=Object(p.a)(n);function n(){return Object(s.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidUpdate",value:function(){var t=this.props.data||void 0;if(t){var e=_.G("#timeLine");F(t.beginDate,t.endDate,t.userListArray,e,t.fixedUserArr,t.articles,t.submit)}}},{key:"render",value:function(){this.props.data;return Object(o.jsxs)("div",{className:"opinionLeaderView",children:[Object(o.jsxs)("div",{className:"heatMap",children:[Object(o.jsx)("div",{className:"optionDiv",style:{width:"100%",display:"grid"},children:Object(o.jsx)("div",{className:"row option d-flex justify-content-start",style:{paddingLeft:"10px",width:"100%",display:"inline"}})}),Object(o.jsx)("div",{className:"timeline",style:{width:"100%",display:"grid"},children:Object(o.jsx)("svg",{id:"timeLine",viewBox:"0 0 826 755"})})]}),Object(o.jsxs)("div",{className:"contextDiv",style:{display:"block"},children:[Object(o.jsxs)("div",{className:"row align-items-center p-0 col-sm",style:{borderBottom:"2px solid slategray"},children:[Object(o.jsx)("div",{className:"col-sm-4",style:{padding:0},children:Object(o.jsx)("p",{id:"value-range"})}),Object(o.jsx)("div",{className:"col-sm-8",style:{paddingLeft:"10px"},children:Object(o.jsx)("div",{id:"slider-range"})})]}),Object(o.jsx)("div",{style:{height:"100%"},children:Object(o.jsx)("svg",{id:"context",viewBox:"0 0 500 1000"})})]})]})}}]),n}(a.a.Component);function T(t,e,n){e.selectAll("*").remove();var r=120,a=[];!function(t,e){var n=new Date(t.date),a=new Date(t.date);a.setHours(n.getHours()+3);var i=_.E().domain([n,a]).range([10,364]),c=_.A().domain([-150,150]).range([r,0]);e.push({article_id:t.article_id,scaleX:i,scaleY:c})}(t,a);_.A().domain([0,1]).range([0,229]);var i=-1,c=-60;e.selectAll("g").data([t]).enter().append("g").attr("class","articles").attr("id",(function(t,e){return"article_".concat(e)})).attr("transform",(function(){return"translate(40,".concat(150+150*(i+=1),")")})).each((function(t,e,n){var a=function(t){var e=new Date(t.date),n=new Date(t.date);n.setHours(e.getHours()+3);var r=_.E().domain([e,n]).range([10,354]),a=function(t){var n=_.K.count(e,new Date(t));return"".concat(Math.floor(n/60),"h").concat(n%60,"m")};return _.a(r).ticks(3).tickFormat((function(t){return a(t)}))}(t),i=u("left"),o=u("right"),d=_.w().x((function(t,e){var n=l(t),r=new Date(t.articleDate).getFullYear();return s(t.articleId,new Date(n).setFullYear(r))})).y((function(t){return _.A().domain([0,100]).range([r,0])(t.value)})).curve(_.g),f=_.G(n[e]),p=f.append("g");p.append("text").text("Title: ".concat(t.article_title)).attr("x",0).attr("y",-130),p.append("text").text("Author: ".concat(t.author)).attr("x",0).attr("y",-110),p.append("text").text("Push: ".concat(t.message_count.push,"  Boo: ").concat(t.message_count.boo,"  \u2192: ").concat(t.message_count.neutral)).attr("x",0).attr("y",-90),p.append("text").text(t.url).attr("x",0).attr("y",-70).attr("fill","blue").on("mouseover",(function(t,e,n){_.G(n[e]).attr("text-decoration","underline")})).on("mouseout",(function(t,e,n){_.G(n[e]).attr("text-decoration","none")})).on("click",(function(){window.open(t.url)})),f.append("g").attr("transform","translate(10, ".concat(c,")")).call(i).append("text").attr("fill","black").attr("font-size",12).attr("text-anchor","middle").attr("transform","translate(-30, ".concat(60,") rotate(-90)")).text("Push - Boo"),f.append("g").attr("transform","translate(".concat(354,", ").concat(c,")")).call(o).append("text").attr("fill","black").attr("font-size",12).attr("text-anchor","middle").attr("transform","translate(40, ".concat(60,") rotate(-90)")).text("comments per 10 mins"),f.append("g").attr("transform","translate(0, ".concat(60,")")).call(a).append("g").attr("transform","translate(0, ".concat(-120,")")).append("path").datum(function(t){var e=JSON.parse(JSON.stringify(t));e.messages.forEach((function(e){e.articleId=t.article_id,e.articleDate=t.date,e.value=1}));for(var n=0;n<e.messages.length;n+=1)for(var r=n+1;r<e.messages.length;r+=1){var a=e.messages[n],i=e.messages[r],c=l(a),o=l(i);if(new Date(o)-new Date(c)>3e5)break;a.value+=i.value,e.messages.splice(r,1),r-=1}return e.messages.filter((function(t){var e=l(t),n=new Date(t.articleDate).getFullYear();return e=new Date(e).setFullYear(n),(new Date(e)-new Date(t.articleDate))/108e5<1}))}(t)).attr("class","line").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",d)})).selectAll("circle").data((function(t){return function(t){var e=JSON.parse(JSON.stringify(t));e.messages.forEach((function(e){switch(e.articleId=t.article_id,e.articleDate=t.date,e.push_tag){case"\u63a8":e.value=1;break;case"\u5653":e.value=-1;break;case"\u2192":e.value=0}}));for(var n=0;n<e.messages.length-1;n+=1){var r=e.messages[n];e.messages[n+1].value+=r.value}return e.messages}(t).filter((function(t){var e=l(t),n=new Date(t.articleDate).getFullYear();return e=new Date(e).setFullYear(n),(new Date(e)-new Date(t.articleDate))/108e5<1}))})).enter().append("circle").attr("class",(function(t){return"id_".concat(t.push_userid)})).attr("fill",(function(t){var e="green";switch(t.push_tag){case"\u63a8":e="green";break;case"\u5653":e="red";break;case"\u2192":e="yellow"}return e})).attr("r",3).attr("cx",(function(t){var e=l(t),n=new Date(t.articleDate).getFullYear();return s(t.articleId,new Date(e).setFullYear(n))})).attr("cy",(function(t){var e,n,r=t.value>150?150:t.value;return r=t.value<-150?-150:r,e=t.articleId,n=r,(0,a.find((function(t){return t.article_id===e})).scaleY)(n)+c})).attr("stroke","black").attr("stroke-width","0.5px").append("title").text((function(t){return t.push_ipdatetime}));var o=[];function l(t){var e="",n=t.push_ipdatetime.split(" ");return 3===n.length?e=(e=e.concat("",n[1])).concat(" ",n[2]):t.push_ipdatetime}function s(t,e){return(0,a.find((function(e){return e.article_id===t})).scaleX)(e)}function u(t){if("left"===t){var e=_.A().domain([-150,150]).range([r,0]);return _.b(e).ticks(7)}if("right"===t){var n=_.A().domain([0,100]).range([r,0]);return _.c(n).ticks(5)}return null}e.selectAll(".articles").each((function(t,e,n){_.G(n[e]).selectAll("circle").each((function(t,n,r){var a=parseFloat(_.G(r[n]).attr("cx")),i=parseFloat(_.G(r[n]).attr("cy"));_.H(".articles").each((function(n,r,c){_.G(c[r]).selectAll(".id_".concat(t.push_userid)).each((function(n,c,l){e<r&&o.push({class:"id_".concat(t.push_userid),x1:a,y1:i+(100+130*e),x2:parseFloat(_.G(l[c]).attr("cx")),y2:parseFloat(_.G(l[c]).attr("cy"))+(100+130*r)})}))}))}))})),e.append("g").attr("class","link").attr("transform","translate(40,0)").selectAll("line").data(o).enter().append("line").attr("class",(function(t){return t.class})).attr("x1",(function(t){return t.x1})).attr("y1",(function(t){return t.y1})).attr("x2",(function(t){return t.x2})).attr("y2",(function(t){return t.y2})).attr("stroke","gray").attr("stroke-opacity",.1).attr("stroke-width",1)}function I(t,e,n){var r=10,a=10,i=parseFloat(_.G(".treemap").style("width")),c=parseFloat(_.G(".treemap").style("height"));e.selectAll("*").remove(),_.G(".treemap").selectAll("div").remove();var o=e.append("g").attr("transform","translate(".concat(a,",").concat(r,")")),s=[],u={children:[]},d=t.filter((function(t){return t.responder}));d.sort((function(t,e){return e.pageRank-t.pagrRank}));var f=[];d.forEach((function(t){t.responder.forEach((function(t){f.some((function(e){return e.article_id===t.articleId}))||f.push(Object(l.a)({article_id:t.articleId},t))}))})),d.filter((function(t,e){return e<20})).forEach((function(t){var e=[],n=0;t.responder.forEach((function(t){n+=t.messages.length})),t.responder.forEach((function(r){e.push({name:r.article_title,id:r.article_id,group:"A",value:r.messages.length*t.pageRank/n,message_count:r.message_count,colname:"level3",messages:r.messages.slice(0,1e3),tag:0})})),u.children.push({name:t.id,children:e})}));var p=_.m(u).sum((function(t){return t.value}));_.L().size([i,c]).paddingInner(0)(p);var h=_.B().domain(["boss1","boss2","boss3"]).range(_.F);_.A().domain([0,1]).range([.5,1]);_.G(".treemap").datum(p).selectAll().data(p.leaves()).enter().append("div").attr("class","node").style("position","absolute").style("overflow","hidden").style("left",(function(t){return"".concat(t.x0,"px")})).style("top",(function(t){return"".concat(t.y0,"px")})).style("width",(function(t){return"".concat(Math.max(0,t.x1-t.x0-1),"px")})).style("height",(function(t){return Math.max(0,t.x1-t.x0-1)<=1?"0px":"".concat(Math.max(0,t.y1-t.y0-1),"px")})).style("background",(function(t){return h(t.parent.data.name)})).style("border","1px solid black").on("click",(function(t,e,n){return function(t,e,n,r){var a=_.G("#articleStatus");T(f.find((function(t){return t.article_id===e})),a,u.$this);var i=_.G('input[name="set"]:checked').property("value");0===t.data.tag?(_.G(r[n]).style("background","black"),t.data.tag=1,s.push(e),"union"===i?t.data.messages.forEach((function(t){m.some((function(e){return e.id===t.push_userid}))||m.push({id:t.push_userid,group:s.length})})):"intersection"===i&&m.length>0?(console.log("intersection"),m=m.filter((function(e){return t.data.messages.some((function(t){return t.push_userid===e.id}))}))):t.data.messages.forEach((function(t){m.some((function(e){return e.id===t.push_userid}))||m.push({id:t.push_userid,group:s.length})}))):(_.G(r[n]).style("background",h(t.parent.data.name)),t.data.tag=0,m=m.filter((function(e){return!t.data.messages.some((function(t){return t.push_userid===e.id}))})));g(m)}(t,t.data.id,e,n)})).append("title").text((function(t){return t.data.name.replace("mister_","")})),o.selectAll("text").data(p.leaves()).enter().append("title").text((function(t){return t.data.name.replace("mister_","")})),o.selectAll("vals").data(p.leaves()).enter().append("text").attr("x",(function(t){return t.x0+5})).attr("y",(function(t){return t.y0+35})).text((function(t){})).attr("font-size","8px").attr("fill","white"),_.G(".treemap").selectAll().data(p.descendants().filter((function(t){return 1===t.depth}))).enter().append("div").style("position","absolute").style("overflow","hidden").style("text-align","center").style("left",(function(t){return"".concat(Math.max(0,(t.x1+t.x0)/2-Math.max(0,t.x1-t.x0-11)/2),"px")})).style("top",(function(t){return"".concat(Math.max(0,t.y1+t.y0)/2-9,"px")})).style("width",(function(t){return"".concat(Math.max(0,t.x1-t.x0-11),"px")})).style("height",(function(t){return t.y1-t.y0>20?"20px":"0px"})).attr("fill",(function(t){return h(t.data.name)})).append("p").text((function(t){return t.data.name.split(" ")[0]})).style("color","black").attr("font-size","12px").style("font-weight",800).style("-webkit-text-stroke","0.5px white");var m=[];function g(t){var e=t,r=_.H(".selectedUserTable");r.selectAll("*").remove(),r.append("div").attr("class","p-1 d-flex justify-content-center").attr("id","submitDiv").append("button").style("type","button").style("padding","2px").attr("class","btn btn-primary").attr("id","submitUsers").text("Get Activity!").on("click",(function(t){var e=[];_.H(".userDataRow").each((function(t,n,r){e.push(_.G(r[n]).selectAll("td").data()[0])})),function(t){n(t)}(e)}));var a=parseFloat(_.G(".selectedUserTable.d-flex.flex-column").style("height"));a-=parseFloat(_.G("#submitDiv").style("height"));var i=r.append("div").style("border","gray 1px solid").style("border-right","0px").style("border-bottom","0px").style("border-radius","5px").style("max-height","".concat(parseInt(a,10),"px")).style("overflow-y","scroll").append("table");i.append("tr").append("td").text("ID(".concat(e.length,")")).style("background",_.F[0]).style("color","white");i.selectAll("tr.user").data(e).enter().append("tr").attr("class","userDataRow").style("padding","0px").append("td").text((function(t){return t.id})).on("click",(function(t){!function(t,e){var n=e.findIndex((function(e){return e.id===t.id}));e.splice(n,1),g(e)}(t,e)}));_.H(".userDataRow").filter(":nth-child(even)").style("background","whitesmoke")}}var C=function(t){Object(f.a)(n,t);var e=Object(p.a)(n);function n(t){var r;return Object(s.a)(this,n),(r=e.call(this,t)).myRef=a.a.createRef(),r.state=Object(l.a)({},t),r}return Object(u.a)(n,[{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(t,e){var n=this.props.set,r=t.set,a=this.state.userData,i=e.userData;if(!n&&!r)return console.log("No Update!"),!1;if(!n&&r)return this.props=t,console.log("update"),this.drawwithlabels(),!0;if(n.length!==r.length||!n.every((function(t,e){return t.id===r[e].id})))return this.props=t,console.log("Update"),this.drawwithlabels(),!0;if(!a&&i)return console.log("Update"),!0;if(a&&i){if(JSON.stringify(a.beginDate)!==JSON.stringify(i.beginDate))return console.log("Update"),!0;if(JSON.stringify(a.endDate)!==JSON.stringify(i.endDate))return console.log("Update"),!0;if(JSON.stringify(a.fixedUserArr)!==JSON.stringify(i.fixedUserArr))return console.log("Update"),!0}return console.log("No Update!"),!1}},{key:"drawwithlabels",value:function(){this.props;function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var a=1===r?_.G("#date1").attr("value"):_.G("#userDate1").property("value"),i=1===r?_.G("#date2").attr("value"):_.G("#userDate2").property("value");console.log("beginDate: ".concat(a,", endDate: ").concat(i));var c=n.map((function(t){return t.id||t})),o={articles:[],userListArray:[]};fetch("https://raw.githubusercontent.com/sean721721721/user-behavior-visualization-demo/master/src/userActivity.json").then((function(t){return t.json()})).then((function(r){console.log(r),o.articles=r.articles,o.userListArray=r.userListArray,o.articles.forEach((function(t){t.messages=t.messages.filter((function(t){return n.some((function(e){return e.id===t.push_userid}))}))})),r.userListArray.forEach((function(t){t.orig_group=n.find((function(e){return e.id===t.id})).group})),e.setState({userData:{beginDate:a,endDate:i,userListArray:r.userListArray,fixedUserArr:c,articles:r.articles,submit:t}})}))}console.log("draw"),console.log("this.props",this.props);var e=this,n=this.props.set,r=JSON.parse(JSON.stringify(n));r.length&&A(r,_.G("#authorList"),0,(function(e,n){I(e,_.G("#graph"),t)}))}},{key:"render",value:function(){console.log("render: ",this.state);var t=this.state.userData;return Object(o.jsxs)("div",{className:"graph",ref:this.myRef,children:[Object(o.jsxs)("div",{className:"network",children:[Object(o.jsxs)("div",{className:"termMap",children:[Object(o.jsx)("div",{className:"termMapFilter",children:Object(o.jsx)("div",{style:{marginLeft:"10px",alignSelf:"center",fontSize:"x-small"},children:Object(o.jsxs)("div",{style:{display:"flex"},children:[Object(o.jsxs)("fieldset",{style:{display:"flex"},children:[Object(o.jsxs)("label",{htmlFor:"union",children:["union:",Object(o.jsx)("input",{checked:!0,type:"radio",id:"union",name:"set",value:"union"})]}),Object(o.jsxs)("label",{htmlFor:"intersection",children:["intersection:",Object(o.jsx)("input",{type:"radio",id:"intersection",name:"set",value:"intersection"})]})]}),Object(o.jsx)("fieldset",{children:Object(o.jsxs)("label",{htmlFor:"intersection",children:["full cal:",Object(o.jsx)("input",{chekced:!0,type:"checkbox",id:"quickTest",name:"pageRank",value:"quickTest"})]})})]})})}),Object(o.jsx)("div",{className:"treemap",style:{position:"relative"},children:Object(o.jsx)("svg",{id:"graph",width:"100%",height:"100%",style:{}})})]}),Object(o.jsx)("div",{className:"selectedUserTable d-flex flex-column"}),Object(o.jsx)("div",{className:"authorList",id:"authorList",style:{overflowY:"scroll"}}),Object(o.jsx)("div",{className:"articleStatus",children:Object(o.jsx)("svg",{id:"articleStatus",viewBox:"0 0 468 275"})})]}),Object(o.jsx)(N,{data:t})]})}}]),n}(r.Component),H=function(t){Object(f.a)(n,t);var e=Object(p.a)(n);function n(t){var r;return Object(s.a)(this,n),(r=e.call(this,t)).state={isLoading:!1,responseError:!1,errorType:"",menuprops:{initParameter:{var1:"reaction",min1:"0",max1:"",var2:"comment",min2:"0",max2:"",posttype:"PTT"},initPage1:{pagename:"Gossiping",since:"2020-07-20",until:"2020-07-21",wordfilter:"\u5433\u76ca\u653f",idfilter:"",contentfilter:"",authorfilter:"",commentfilter:1},submitType:"All"},visprops:{list:[],date:[{$gte:"",$lt:""}],word:[[""]]}},r.getFilename=r.getFilename.bind(Object(d.a)(r)),r.getReqstr=r.getReqstr.bind(Object(d.a)(r)),r.changeList=r.changeList.bind(Object(d.a)(r)),r.handleSubmit=r.handleSubmit.bind(Object(d.a)(r)),r.handleTab=r.handleTab.bind(Object(d.a)(r)),r}return Object(u.a)(n,[{key:"getFilename",value:function(){var t=this.state.menuprops.initPage1,e=t.pagename,n=t.since,r=t.until;return"".concat(e,"_").concat(n,"_").concat(r,".csv")}},{key:"getReqstr",value:function(){var t=this.state.menuprops,e=t.initParameter,n=e.var1,r=e.min1,a=e.max1,i=e.posttype,c=t.initPage1,o=c.pagename,l=c.since,s=c.until,u=c.wordfilter,d=c.contentfilter,f=c.idfilter,p=c.authorfilter,h=c.commentfilter,m=t.submitType,g="min".concat(n,"=").concat(r)||!1,v="max".concat(n,"=").concat(a)||!1,y="posttype=".concat(i)||!1,x="page1=".concat(o)||!1,b="time1=".concat(l)||!1,w="time2=".concat(s)||!1,_="user1=".concat(f)||!1,k="author1=".concat(p)||!1,D="keyword1=".concat(u)||!1,j="keyword3=".concat(d)||!1,A="commentThreshold=".concat(h)||!1,O="co=".concat(m)||!1;return"".concat("/searching?"+g,"&").concat(v,"&").concat(y,"&")+"".concat(x,"&").concat(b,"&").concat(w,"&").concat(k,"&").concat(_,"&").concat(D,"&").concat(j,"&").concat(A,"&").concat(O)}},{key:"setResponseError",value:function(){this.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{responseError:!0})}))}},{key:"handleSubmit",value:function(t){var e=this;fetch("https://raw.githubusercontent.com/sean721721721/user-behavior-visualization-demo/master/src/example.json").then((function(t){if(t.status>=200&&t.status<300)return t.json();var e=new Error(t.statusText);throw e.response=t,e})).then((function(t){console.log(t),console.log("done!"),e.changeList(t,0)}))}},{key:"changeList",value:function(t,e){var n=t.list;t.next,t.previous;this.setState((function(t){return Object(l.a)(Object(l.a)({isLoading:!1},t),{},{visprops:{set:n[e+1][0]}})})),console.log("change"),this.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{isLoading:!1})}))}},{key:"handleTab",value:function(t,e){console.log(t,e);var n=t.target,r=n.name,a=n.value;this.setState((function(t){var n=m.a.cloneDeep(t);return n.menuprops[e][r]=a,n}))}},{key:"render",value:function(){var t=this,e=this.state,n=e.isLoading,r=e.responseError,a=e.errorType,i=e.menuprops,c=e.visprops;return Object(o.jsxs)("div",{className:"container-fluid",children:[Object(o.jsx)("div",{className:"navbar",children:Object(o.jsx)(b,{menuprops:i,onSubmit:this.handleSubmit,handlePT:function(e){return t.handleTab(e,"initParameter")},handlePT1:function(e){return t.handleTab(e,"initPage1")}})}),Object(o.jsx)("div",{className:"grid",children:Object(o.jsxs)("div",{className:"grid1",children:[Object(o.jsx)(w,{isLoading:n,responseError:r,errorType:a}),Object(o.jsx)(C,{set:c.set,opState:this.state})]})})]})}}]),n}(a.a.Component),P=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,175)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,c=e.getTTFB;n(t),r(t),a(t),i(t),c(t)}))};n(167);c.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(H,{})}),document.getElementById("root")),P()},70:function(t,e,n){var r,a,i,c,o,l,s={},u={};function d(t){var e={};return t.forEach((function(t,n){e[t]=!0})),Object.keys(e)}function f(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e}function p(t,e){var n=t._assoc_mat[e]?Object.keys(t._assoc_mat[e]):[],r=0;return n.forEach((function(n,a){var i=t._assoc_mat[e][n]||1;e===n&&(i*=2),r+=i})),r}function h(t,e){return"undefined"===typeof t._assoc_mat[e]?[]:Object.keys(t._assoc_mat[e])}function m(t,e,n){return t._assoc_mat[e]?t._assoc_mat[e][n]:void 0}function g(t){var e={};return t.forEach((function(t,n){e[t.source]=e[t.source]||{},e[t.source][t.target]=t.weight,e[t.target]=e[t.target]||{},e[t.target][t.source]=t.weight})),e}function v(t){if(null===t||"object"!==typeof t)return t;var e=t.constructor();for(var n in t)e[n]=v(t[n]);return e}function y(t,e,n){e.nodes_to_com={},e.total_weight=0,e.internals={},e.degrees={},e.gdegrees={},e.loops={},e.total_weight=function(t){var e=0;return t.edges.forEach((function(t){e+=t.weight})),e}(t),"undefined"===typeof n?t.nodes.forEach((function(n,r){e.nodes_to_com[n]=r;var a=p(t,n);if(a<0)throw new TypeError("Graph should only have positive weights.");e.degrees[r]=a,e.gdegrees[n]=a,e.loops[n]=m(t,n,n)||0,e.internals[r]=e.loops[n]})):t.nodes.forEach((function(r,a){var i=n[r];e.nodes_to_com[r]=i;var c=p(t,r);e.degrees[i]=(e.degrees[i]||0)+c,e.gdegrees[r]=c;var o=0;h(t,r).forEach((function(e){var a=t._assoc_mat[r][e];if(a<=0)throw new TypeError("Graph should only have positive weights.");n[e]===i&&(o+=e===r?a:a/2)})),e.internals[i]=(e.internals[i]||0)+o}))}function x(t){var e=t.total_weight,n=0;return d(f(t.nodes_to_com)).forEach((function(r,a){var i=t.internals[r]||0,c=t.degrees[r]||0;e>0&&(n=n+i/e-Math.pow(c/(2*e),2))})),n}function b(t,e,n){var r={};return h(e,t).forEach((function(a){if(a!==t){var i=e._assoc_mat[t][a]||1,c=n.nodes_to_com[a];r[c]=(r[c]||0)+i}})),r}function w(t,e,n,r){r.nodes_to_com[t]=+e,r.degrees[e]=(r.degrees[e]||0)+(r.gdegrees[t]||0),r.internals[e]=(r.internals[e]||0)+n+(r.loops[t]||0)}function _(t,e,n,r){r.degrees[e]=(r.degrees[e]||0)-(r.gdegrees[t]||0),r.internals[e]=(r.internals[e]||0)-n-(r.loops[t]||0),r.nodes_to_com[t]=-1}function k(t){var e=0,n=v(t),r={};return Object.keys(t).forEach((function(a){var i=t[a],c="undefined"===typeof r[i]?-1:r[i];-1===c&&(r[i]=e,c=e,e+=1),n[a]=c})),n}function D(t,e){for(var n=!0,r=0,a=x(e),i=a;n&&-1!==r&&(a=i,n=!1,r+=1,t.nodes.forEach((function(r,a){var i=e.nodes_to_com[r],c=(e.gdegrees[r]||0)/(2*e.total_weight),o=b(r,t,e);_(r,i,o[i]||0,e);var l=i,s=0;Object.keys(o).forEach((function(t){var n=o[t]-(e.degrees[t]||0)*c;n>s&&(s=n,l=t)})),w(r,l,o[l]||0,e),l!==i&&(n=!0)})),!((i=x(e))-a<1e-7)););}function j(t,e){var n,r,a={nodes:[],edges:[],_assoc_mat:{}},i=f(t);return a.nodes=a.nodes.concat(d(i)),e.edges.forEach((function(e,i){r=e.weight||1;var c=t[e.source],o=t[e.target];n=m(a,c,o)||0,function(t,e){!function(t,e){t._assoc_mat[e.source]=t._assoc_mat[e.source]||{},t._assoc_mat[e.source][e.target]=e.weight,t._assoc_mat[e.target]=t._assoc_mat[e.target]||{},t._assoc_mat[e.target][e.source]=e.weight}(t,e),u["".concat(e.source,"_").concat(e.target)]?t.edges[u["".concat(e.source,"_").concat(e.target)]].weight=e.weight:(t.edges.push(e),u["".concat(e.source,"_").concat(e.target)]=t.edges.length-1)}(a,{source:c,target:o,weight:n+r})})),u={},a}"undefined"!==typeof self&&self,a=[],void 0===(i="function"===typeof(r=function(){return function(){var t=function(){var t=function(t,e){if(0===t.edges.length){var n={};return t.nodes.forEach((function(t){n[t]=t})),n}var r={};y(s,r,e);var a=x(r),i=[];D(s,r);var c=x(r),o=k(r.nodes_to_com);i.push(o),a=c;var l=j(o,s);for(y(l,r);D(l,r),!((c=x(r))-a<1e-7);)o=k(r.nodes_to_com),i.push(o),a=c,y(l=j(o,l),r);return i}(s,l);return function(t,e){for(var n=v(t[0]),r=function(e){Object.keys(n).forEach((function(r,a){var i=r,c=n[r];n[i]=t[e][c]}))},a=1;a<e+1;a++)r(a);return n}(t,t.length-1)};return t.nodes=function(e){return arguments.length>0&&(c=e),t},t.edges=function(e){if("undefined"===typeof c)throw new TypeError("Graph nodes are undefined");if(arguments.length>0){o=e;var n=g(e);s={nodes:c,edges:o,_assoc_mat:n}}return t},t.partition_init=function(e){return arguments.length>0&&(l=e),t},t}})?r.apply(e,a):r)||(t.exports=i)}},[[169,1,2]]]);
//# sourceMappingURL=main.e38820b9.chunk.js.map